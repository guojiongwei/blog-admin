import{n as o,m as c}from"./index.805c5d76.js";var p=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("article",[t("el-dialog",{staticClass:"edit-wrapper",attrs:{title:"\u7BA1\u7406\u5458\u7F16\u8F91",visible:e.dialogTableVisible,width:"80%"},on:{"update:visible":function(r){e.dialogTableVisible=r},close:e.close}},[t("div",{staticClass:"box"},[t("el-form",{ref:"form",staticClass:"form",attrs:{model:e.info,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"\u540D\u5B57",prop:"name"}},[t("el-input",{attrs:{type:"text"},model:{value:e.info.name,callback:function(r){e.$set(e.info,"name",r)},expression:"info.name"}})],1),t("el-form-item",{attrs:{label:"\u7528\u6237\u540D",prop:"username"}},[t("el-input",{attrs:{type:"text"},model:{value:e.info.username,callback:function(r){e.$set(e.info,"username",r)},expression:"info.username"}})],1),t("el-form-item",{attrs:{label:"\u539F\u5BC6\u7801",prop:"old_pwd"}},[t("el-input",{attrs:{type:"password"},model:{value:e.info.old_pwd,callback:function(r){e.$set(e.info,"old_pwd",r)},expression:"info.old_pwd"}})],1),t("el-form-item",{attrs:{label:"\u65B0\u5BC6\u7801",prop:"pwd"}},[t("el-input",{attrs:{type:"password"},model:{value:e.info.pwd,callback:function(r){e.$set(e.info,"pwd",r)},expression:"info.pwd"}})],1),t("el-form-item",{attrs:{label:"\u6743\u9650",prop:"roles"}},[t("el-select",{staticClass:"block",attrs:{multiple:"",placeholder:"\u8BF7\u9009\u62E9"},model:{value:e.info.roles,callback:function(r){e.$set(e.info,"roles",r)},expression:"info.roles"}},e._l(e.roles,function(r){return t("el-option",{key:r.value,attrs:{label:r.label,value:r.value}})}),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:function(r){return e.submitForm("form")}}},[e._v("\u7F16\u8F91")])],1)],1)],1)])],1)},h=[];const f={props:["info"],data(){return{roles:[{label:"\u8D85\u7EA7\u7BA1\u7406\u5458",value:"admin"},{label:"\u666E\u901A\u7BA1\u7406\u5458",value:"default"}],loading:!1,dialogTableVisible:!0,rules:{name:[{required:!0,message:"\u8BF7\u586B\u5199\u540D\u5B57",trigger:"blur"}],username:[{required:!0,message:"\u8BF7\u586B\u5199\u7528\u6237\u540D",trigger:"blur"}],old_pwd:[{required:!0,message:"\u8BF7\u586B\u5199\u539F\u5BC6\u7801",trigger:"blur"}],pwd:[{required:!0,message:"\u8BF7\u586B\u5199\u5BC6\u7801",trigger:"blur"}],roles:[{required:!0,message:"\u8BF7\u9009\u62E9\u6743\u9650",trigger:"change",type:"array"}]}}},methods:{close(){this.$emit("close")},submitForm(e){this.loading=!0,this.$refs[e].validate(async i=>{if(i)try{delete this.info.createTime,delete this.info.releaseTime,await this.$store.dispatch("updateUser",this.info),this.loading=!1,this.$router.push("/permission/list"),this.close()}catch{this.info.pwd="",this.info.old_pwd="",this.loading=!1}else return console.log("error submit!!"),this.loading=!1,!1})}}},s={};var g=o(f,p,h,!1,m,"7c3ac3f1",null,null);function m(e){for(let i in s)this[i]=s[i]}var _=function(){return g.exports}(),v=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("article",[t("div",{staticClass:"search"},[t("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9","prefix-icon":"el-icon-search"},nativeOn:{keydown:function(r){return!r.type.indexOf("key")&&e._k(r.keyCode,"enter",13,r.key,"Enter")?null:e.getUserList.apply(null,arguments)}},model:{value:e.keyword,callback:function(r){e.keyword=r},expression:"keyword"}}),t("el-button",{attrs:{type:"primary",icon:"el-icon-search",loading:e.loading},on:{click:e.getUserList}},[e._v("\u641C\u7D22")])],1),t("el-table",{ref:"multipleTable",attrs:{data:e.userList,"tooltip-effect":"dark",stripe:"",border:""}},[t("el-table-column",{attrs:{type:"index",width:"55",align:"center","header-align":"center",index:e.increment}}),e._l(e.headerOptions,function(r,a){return r.hidden?e._e():t("el-table-column",{key:a,attrs:{"show-overflow-tooltip":"",label:r.label,prop:r.prop,"header-align":r.headerAlign,align:r.align,"min-width":r.minWidth||150},scopedSlots:e._u([{key:"default",fn:function(n){return[n.column.property==="roles"?t("div",e._l(n.row.roles,function(d,u){return t("el-tag",{key:u,staticClass:"tag",attrs:{type:"primary","close-transition":""}},[e._v(e._s(d))])}),1):n.column.property==="avatar"?t("div",[t("img",{staticStyle:{height:"40px"},attrs:{src:n.row[n.column.property],alt:""}})]):t("div",[e._v(e._s(n.row[n.column.property]||"\u65E0"))])]}}],null,!0)})}),t("el-table-column",{attrs:{label:"\u64CD\u4F5C","header-align":"center",align:"center",width:"250"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.edit(r)}}},[e._v("\u7F16\u8F91")]),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.del(r)}}},[e._v("\u5220\u9664")])]}}])})],2),t("el-pagination",{staticClass:"pagination",attrs:{"current-page":e.pageindex,"page-sizes":e.size_scoped,"page-size":e.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.userTotal},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e.editShow?t("EditComponent",{attrs:{info:e.userInfo},on:{close:e.close}}):e._e()],1)},y=[];const b={components:{EditComponent:_},data(){return{keyword:"",editShow:!1,userInfo:{},loading:!1,pageindex:1,pagesize:10,size_scoped:[10,20,30,40],headerOptions:[{label:"id",prop:"_id",hidden:!0,headerAlign:"center",align:"center",width:""},{label:"\u7528\u6237\u540D",prop:"username",hidden:!1,headerAlign:"center",align:"center",width:""},{label:"\u59D3\u540D",prop:"name",hidden:!1,headerAlign:"center",align:"center",width:"",sort:!0},{label:"\u6743\u9650",prop:"roles",hidden:!1,headerAlign:"center",align:"center",width:"",sort:!0}],multipleSelection:[]}},mounted(){this.getUserList()},methods:{increment(e){return e+1+(this.pageindex-1)*this.pagesize},close(){this.editShow=!1,this.getUserList()},handleSizeChange(e){this.pagesize=e,this.getUserList()},handleCurrentChange(e){this.pageindex=e,this.getUserList()},async getUserList(){this.loading=!0;try{await this.$store.dispatch("getUserList",{keyword:this.keyword,pageindex:this.pageindex,pagesize:this.pagesize}),this.loading=!1}catch{this.loading=!1}},del(e){this.$confirm("\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664\u8BE5\u6587\u4EF6, \u662F\u5426\u7EE7\u7EED?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning",center:!0}).then(async()=>{try{await this.$store.dispatch("delUser",e.row._id),this.userList.splice(e.$index,1)}catch{}this.$message({type:"success",message:"\u5220\u9664\u6210\u529F!"})}).catch(()=>{this.$message({type:"info",message:"\u5DF2\u53D6\u6D88\u5220\u9664"})})},edit(e){console.log(e),this.editShow=!0,e.row.releaseTime=new Date(e.row.releaseTime),this.userInfo=e.row},filterTag(e,i){return i.type.some(t=>t===e)}},computed:{...c(["userList","userTotal"])}},l={};var w=o(b,v,y,!1,x,"b517c72e",null,null);function x(e){for(let i in l)this[i]=l[i]}var $=function(){return w.exports}();export{$ as default};
